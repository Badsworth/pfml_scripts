
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.0">
    
    
      
        <title>Technical Overview - PFML</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.fe914879.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ba0d045b.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#technical-overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="PFML" class="md-header__button md-logo" aria-label="PFML" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PFML
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Technical Overview
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/EOLWD/PFML/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    EOLWD/pfml
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="PFML" class="md-nav__button md-logo" aria-label="PFML" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    PFML
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/EOLWD/PFML/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    EOLWD/pfml
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Massachusetts PFML (Portal and API)
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../creating-environments/" class="md-nav__link">
        Setting up a new environment
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../deployment/" class="md-nav__link">
        Deployment
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../tools/" class="md-nav__link">
        Tools
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      <label class="md-nav__link" for="__nav_6">
        Api
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Api" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Api
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../automated-tests/" class="md-nav__link">
        Automated Tests
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../database-migrations/" class="md-nav__link">
        Database Migrations
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../db-roles-and-users/" class="md-nav__link">
        Database Users
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../development-environment-setup/" class="md-nav__link">
        Development Environment Setup
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../environment-variables/" class="md-nav__link">
        Environment Variables
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../fields-and-validations/" class="md-nav__link">
        Fields and validations
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../monitoring/" class="md-nav__link">
        API Monitoring
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../running-the-application-docker/" class="md-nav__link">
        Running the Application (Docker)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ses/" class="md-nav__link">
        Ses
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Technical Overview
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Technical Overview
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-technologies" class="md-nav__link">
    Key Technologies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#request-operations" class="md-nav__link">
    Request operations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication" class="md-nav__link">
    Authentication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authorization" class="md-nav__link">
    Authorization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-in-hosted-environments" class="md-nav__link">
    Running In Hosted Environments
  </a>
  
    <nav class="md-nav" aria-label="Running In Hosted Environments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ecs" class="md-nav__link">
    ECS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lambda" class="md-nav__link">
    Lambda
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../working-with-releases/" class="md-nav__link">
        Working With Releases
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../writing-tests/" class="md-nav__link">
        Writing Tests
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      <label class="md-nav__link" for="__nav_7">
        Infra
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Infra" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Infra
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../infra/adding-ses-email-address/" class="md-nav__link">
        Adding a new SES email address
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../infra/making-changes-to-alerts/" class="md-nav__link">
        Making Changes to Alerts
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../infra/testing-github-action-permissions/" class="md-nav__link">
        Testing Github Actions permissions
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      <label class="md-nav__link" for="__nav_8">
        Portal
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Portal" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Portal
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../portal/browser-support/" class="md-nav__link">
        Browser support
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../portal/creating-environments/" class="md-nav__link">
        Setting up a new environment
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../portal/development/" class="md-nav__link">
        Portal Development
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../portal/environment-variables/" class="md-nav__link">
        Environment variables
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../portal/error-handling/" class="md-nav__link">
        Error handling
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../portal/feature-flags/" class="md-nav__link">
        Feature flags
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../portal/internationalization/" class="md-nav__link">
        Internationalization
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../portal/maintenance-pages/" class="md-nav__link">
        Maintenance pages
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../portal/monitoring/" class="md-nav__link">
        Monitoring
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../portal/naming-conventions/" class="md-nav__link">
        Naming conventions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../portal/software-architecture/" class="md-nav__link">
        Software Architecture
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../portal/storybook/" class="md-nav__link">
        Storybook
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../portal/tests/" class="md-nav__link">
        Tests
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../portal/web-analytics/" class="md-nav__link">
        Web Analytics
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      <label class="md-nav__link" for="__nav_9">
        Releases
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Releases" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Releases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../releases/api/" class="md-nav__link">
        Api
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../releases/portal/" class="md-nav__link">
        Portal
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-technologies" class="md-nav__link">
    Key Technologies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#request-operations" class="md-nav__link">
    Request operations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication" class="md-nav__link">
    Authentication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authorization" class="md-nav__link">
    Authorization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-in-hosted-environments" class="md-nav__link">
    Running In Hosted Environments
  </a>
  
    <nav class="md-nav" aria-label="Running In Hosted Environments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ecs" class="md-nav__link">
    ECS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lambda" class="md-nav__link">
    Lambda
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/EOLWD/PFML/edit/master/docs/api/technical-overview.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="technical-overview">Technical Overview</h1>
<ul>
<li><a href="#key-technologies">Key Technologies</a></li>
<li><a href="#request-operations">Request operations</a></li>
<li><a href="#authentication">Authentication</a></li>
<li><a href="#authorization">Authorization</a></li>
<li><a href="#running-in-hosted-environments">Running In Hosted Environments</a></li>
<li><a href="#ecs">ECS</a></li>
<li><a href="#lambda">Lambda</a></li>
</ul>
<h2 id="key-technologies">Key Technologies</h2>
<p>The API is written in Python, utilizing Connexion as the web application
framework (with Flask serving as the backend for Connexion). The API is
described in the OpenAPI Specification format in the file
<a href="https://github.com/EOLWD/pfml/tree/main/api/openapi.yaml">openapi.yaml</a>.</p>
<p>SQLAlchemy is the ORM, with migrations driven by Alembic. pydantic is used in
many spots for parsing data (and often serializing it to json or plain
dictionaries). Where pydantic is not used, plain Python dataclasses are
generally preferred.</p>
<ul>
<li><a href="http://spec.openapis.org/oas/v3.0.3">OpenAPI Specification</a></li>
<li><a href="https://connexion.readthedocs.io/en/latest/">Connexion</a> (<a href="https://github.com/zalando/connexion">source code</a>)</li>
<li><a href="https://www.sqlalchemy.org/">SQLAlchemy</a> (<a href="https://github.com/sqlalchemy/sqlalchemy">source code</a>)</li>
<li><a href="https://alembic.sqlalchemy.org/en/latest/">Alembic</a> (<a href="alembic-src">source code</a>)</li>
<li><a href="https://pydantic-docs.helpmanual.io/">pydantic</a> (<a href="https://github.com/samuelcolvin/pydantic/">source code</a>)</li>
<li><a href="https://python-poetry.org/docs/">poetry</a> - Python dependency management</li>
</ul>
<h2 id="request-operations">Request operations</h2>
<ul>
<li>OpenAPI spec (<code>openapi.yaml</code>) defines API interface: routes, requests, responses, etc.</li>
<li>Connexion connects routes to handlers via <code>operationId</code> property on a route<ul>
<li>Connexion will run OAS validations before reaching handler</li>
<li>Connexion will run authentication code and set user in the request context</li>
<li>The handlers generally live in the top level files at
  <a href="https://github.com/EOLWD/pfml/tree/main/api/massgov/pfml/api/">massgov/pfml/api</a>, with the <code>operationId</code> pointing
  to the specific module and function</li>
</ul>
</li>
<li>Handlers check if user in request context is authorized to perform the action
  the request represents</li>
<li>Handlers use pydantic models to parse request bodies and construct response data</li>
<li>Connexion will run OAS validations on response format from handler</li>
</ul>
<h2 id="authentication">Authentication</h2>
<p>Authentication methods are defined in the <code>securitySchemes</code> block in
<code>openapi.yaml</code>. A particular security scheme is enabled for a route via a
<code>security</code> block on that route. Note the <code>jwt</code> scheme is enabled by default for
every route via the global <code>security</code> block at the top of <code>openapi.yaml</code>.</p>
<p>Connexion runs the authentication before passing the request to the route
handler. In the <code>jwt</code> security scheme, the <code>x-bearerInfoFunc</code> points to the
function that is run to do the authentication.</p>
<h2 id="authorization">Authorization</h2>
<p>Authorization is handled via the
<a href="https://github.com/bouncer-app/bouncer">bouncer</a> and
<a href="https://github.com/bouncer-app/flask-bouncer">flask-bouncer</a> libraries.</p>
<p>The rules are defined in
<a href="https://github.com/EOLWD/pfml/tree/main/api/massgov/pfml/api/authorization/rules.py">massgov/pfml/api/authorization/rules.py</a>,
and request handlers use the <code>ensure</code> and <code>can</code> functions provided by
flask-bouncer (re-exported in
<a href="https://github.com/EOLWD/pfml/tree/main/api/massgov/pfml/api/authorization/flask.py">massgov/pfml/api/authorization/flask.py</a>
for use in the application, as we may eventually want to provide slightly
modified versions of the functions provided by flask-bouncer directly) to check
if the user in the current request context is authorized to perform the given
action on the given subject.</p>
<h2 id="running-in-hosted-environments">Running In Hosted Environments</h2>
<p>There are two ways code gets run in hosted environments, as tasks on <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/Welcome.html">AWS
Elastic Container Service (ECS) clusters</a> (backed by <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/AWS_Fargate.html">AWS
Fargate</a>) and as <a href="https://docs.aws.amazon.com/lambda/latest/dg/welcome.html">AWS Lambdas</a>.</p>
<p>For actually performing deploys, see
<a href="https://github.com/EOLWD/pfml/tree/main/docs/deployment.md">/docs/deployment.md</a>.</p>
<h3 id="ecs">ECS</h3>
<p>ECS tasks all share the same container as built by the <code>app</code> stage of the
<code>Dockerfile</code>. This stage builds the project Python package (basically zip up
<a href="https://github.com/EOLWD/pfml/tree/main/api/massgov">massgov/</a>) and installs it into the container environment.</p>
<p>This also has the effect of making the package entrypoints as listed in the
<code>[tool.poetry.scripts]</code> section of <a href="https://github.com/EOLWD/pfml/tree/main/api/pyproject.toml">pyproject.toml</a>
available on <code>PATH</code>, so ECS tasks besides the Paid Leave API server tend to set
one of these as their Docker command.</p>
<p>The Paid Leave API server ECS task is declared in
<a href="https://github.com/EOLWD/pfml/tree/main/infra/api/template/service.tf">/infra/api/template/service.tf</a> as well as its
ECS service, which is a wrapper for ECS tasks to ensure a specified number of
the tasks are running, provides mechanisms for autoscaling, and various other
"service" features.</p>
<p>Other ECS tasks are in
<a href="https://github.com/EOLWD/pfml/tree/main/infra/ecs-tasks/template/tasks.tf">/infra/ecs-tasks/template/tasks.tf</a>. These
are not a part of an ECS service, the tasks are launched/started on demand
(either by an automated process like a scheduled AWS EventBridge event, Step
Function, or manually through the <a href="https://github.com/EOLWD/pfml/tree/main/bin/run-ecs-task/">/bin/run-ecs-task</a> tool).</p>
<h3 id="lambda">Lambda</h3>
<p>Lambdas are a little different. Their main source code lives somewhere in
<a href="https://github.com/EOLWD/pfml/tree/main/api/massgov">massgov/</a>, with their build infrastructure in
<a href="https://github.com/EOLWD/pfml/tree/main/api/lambdas">lambdas/</a> which is mostly boilerplate to import the correct
module from <a href="https://github.com/EOLWD/pfml/tree/main/api/massgov">massgov/</a> and build it as appropriate for the Lambda
runtime.</p>
<p>The Lambda building happens via the AWS Serverless Application Model (SAM) CLI
tool, which takes the project Python package and builds its dependencies inside
a Docker container matching the Lambda runtime environment (for cases where a
dependency needs a compiled component). This generates a ZIP of the Lambda,
which can then be uploaded to S3.</p>
<p>The Lambda configuration and deploys are done in Terraform, at
<a href="https://github.com/EOLWD/pfml/tree/main/infra/api/template/lambda.tf">/infra/api/template/lambda.tf</a>.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../ses/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Ses" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Ses
            </div>
          </div>
        </a>
      
      
        
        <a href="../working-with-releases/" class="md-footer__link md-footer__link--next" aria-label="Next: Working With Releases" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Working With Releases
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.53c85856.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.716f8af4.min.js"></script>
      
    
  </body>
</html>