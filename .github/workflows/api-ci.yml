# Run tests and linting for the Paid Leave API.
#
name: API CI Testing

on:
  pull_request:
    paths:
    - api/**

defaults:
  run:
    working-directory: ./api

env:
  CI: true

jobs:

  # Check for formatting and linting issues.
  lint:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    # for efficiency, spin up the container once and run commands in the same
    # environment, instead of starting and stopping the container for each step
    - name: build and start container
      run: make start


    - name: format-check
      run: make format-check

    - name: lint
      run: make lint

  # Check for test failures.
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: build and start container
      run: make start

    - name: test
      run: make test

  # Check we can build a release
  build-release:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: build
      run: make release-build
