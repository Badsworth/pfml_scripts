/**
 * @file Node script that generates a components export file,
 * which is a dependency for Playroom.
 */
const fs = require("fs");
const readdirp = require("readdirp");

const componentsDir = "src/components/";
const outputDir = "playroom/autogenerated/";
const outputPath = `${outputDir}components.js`;

async function generateComponentExports() {
  const componentFiles = await readdirp.promise(componentsDir, {
    depth: 0,
    fileFilter: "*.js",
  });

  const doc = `
/**
 * @file This file is autogenerated. It exposes our components for use
 * within the Playroom editor.
 */
`;

  const exports = componentFiles
    .map((file) => {
      const ComponentName = file.path.replace(".js", "");
      return `export { default as ${ComponentName} } from "../../${componentsDir}${file.path}";`;
    })
    .join("\n");

  const outputData = [doc, exports].join("\n");

  await fs.promises.mkdir(outputDir, { recursive: true });
  await fs.promises.writeFile(outputPath, outputData, {
    encoding: "utf8",
  });
}

generateComponentExports();
