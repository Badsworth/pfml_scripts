
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.5">
    
    
      
        <title>Setting up a new environment - PFML</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.be71726b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#setting-up-a-new-environment" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="PFML" class="md-header__button md-logo" aria-label="PFML" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PFML
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Setting up a new environment
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/EOLWD/PFML/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    EOLWD/pfml
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="PFML" class="md-nav__button md-logo" aria-label="PFML" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    PFML
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/EOLWD/PFML/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    EOLWD/pfml
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Massachusetts PFML (Portal and API)
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../archiving-code/" class="md-nav__link">
        Process for Archiving Code
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Setting up a new environment
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Setting up a new environment
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-initial-setup" class="md-nav__link">
    1. Initial Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-set-up-the-api" class="md-nav__link">
    2. Set up the API
  </a>
  
    <nav class="md-nav" aria-label="2. Set up the API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#20-create-the-api-gateway" class="md-nav__link">
    2.0 Create the API Gateway
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21-create-the-api" class="md-nav__link">
    2.1 Create the API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-create-the-ecs-tasks" class="md-nav__link">
    2.2 Create the ECS Tasks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-setting-up-the-portal-environment" class="md-nav__link">
    3. Setting up the Portal Environment
  </a>
  
    <nav class="md-nav" aria-label="3. Setting up the Portal Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-cognito" class="md-nav__link">
    Configuring Cognito
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-integrating-with-fineos" class="md-nav__link">
    4. Integrating with FINEOS
  </a>
  
    <nav class="md-nav" aria-label="4. Integrating with FINEOS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-pfml-credentials-for-fineos" class="md-nav__link">
    Configure PFML credentials for FINEOS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-fineos-credentials-for-pfml" class="md-nav__link">
    Configure FINEOS credentials for PFML
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-update-ci-and-monitoring" class="md-nav__link">
    4. Update CI and Monitoring
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-custom-domains" class="md-nav__link">
    Setting up Custom Domains
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../deployment/" class="md-nav__link">
        Deployment
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../github-teams-and-codeowners/" class="md-nav__link">
        Github Teams and Code Owners
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../test_fineos_from_local_setup/" class="md-nav__link">
        Test Fineos server from local setup
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tools/" class="md-nav__link">
        Tools
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      <label class="md-nav__link" for="__nav_9">
        Api
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Api" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Api
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/archive-reference/" class="md-nav__link">
        Archived Features Overview (API)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/automated-tests/" class="md-nav__link">
        Automated Tests
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/database-migrations/" class="md-nav__link">
        Database Migrations
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/db-roles-and-users/" class="md-nav__link">
        Database Users
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/development-environment-setup/" class="md-nav__link">
        Development Environment Setup
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/environment-variables/" class="md-nav__link">
        Environment Variables
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/fields-and-validations/" class="md-nav__link">
        Fields and validations
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/monitoring/" class="md-nav__link">
        API Monitoring
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/running-the-application-docker/" class="md-nav__link">
        Running the Application (Docker)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/security/" class="md-nav__link">
        API Security
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/ses/" class="md-nav__link">
        Ses
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/technical-overview/" class="md-nav__link">
        Technical Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/working-with-releases/" class="md-nav__link">
        Working With Releases
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/writing-tests/" class="md-nav__link">
        Writing Tests
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      <label class="md-nav__link" for="__nav_10">
        Infra
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Infra" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Infra
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../infra/adding-ses-email-address/" class="md-nav__link">
        Adding a new SES email address
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../infra/making-changes-to-alerts/" class="md-nav__link">
        Making Changes to Alerts
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../infra/testing-github-action-permissions/" class="md-nav__link">
        Testing Github Actions permissions
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11" type="checkbox" id="__nav_11" >
      
      <label class="md-nav__link" for="__nav_11">
        Portal
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Portal" data-md-level="1">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          Portal
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../portal/browser-support/" class="md-nav__link">
        Browser support
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../portal/creating-environments/" class="md-nav__link">
        Setting up a new environment
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../portal/development/" class="md-nav__link">
        Portal Development
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../portal/environment-variables/" class="md-nav__link">
        Environment variables
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../portal/error-handling/" class="md-nav__link">
        Error handling
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../portal/feature-flags/" class="md-nav__link">
        Feature flags
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../portal/internationalization/" class="md-nav__link">
        Internationalization
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../portal/maintenance-pages/" class="md-nav__link">
        Maintenance pages
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../portal/monitoring/" class="md-nav__link">
        Monitoring
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../portal/naming-conventions/" class="md-nav__link">
        Naming conventions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../portal/software-architecture/" class="md-nav__link">
        Software Architecture
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../portal/storybook/" class="md-nav__link">
        Storybook
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../portal/tests/" class="md-nav__link">
        Tests
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../portal/web-analytics/" class="md-nav__link">
        Web Analytics
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_12" type="checkbox" id="__nav_12" >
      
      <label class="md-nav__link" for="__nav_12">
        Releases
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Releases" data-md-level="1">
        <label class="md-nav__title" for="__nav_12">
          <span class="md-nav__icon md-icon"></span>
          Releases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../releases/api/" class="md-nav__link">
        Api
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../releases/portal/" class="md-nav__link">
        Portal
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-initial-setup" class="md-nav__link">
    1. Initial Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-set-up-the-api" class="md-nav__link">
    2. Set up the API
  </a>
  
    <nav class="md-nav" aria-label="2. Set up the API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#20-create-the-api-gateway" class="md-nav__link">
    2.0 Create the API Gateway
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21-create-the-api" class="md-nav__link">
    2.1 Create the API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-create-the-ecs-tasks" class="md-nav__link">
    2.2 Create the ECS Tasks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-setting-up-the-portal-environment" class="md-nav__link">
    3. Setting up the Portal Environment
  </a>
  
    <nav class="md-nav" aria-label="3. Setting up the Portal Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-cognito" class="md-nav__link">
    Configuring Cognito
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-integrating-with-fineos" class="md-nav__link">
    4. Integrating with FINEOS
  </a>
  
    <nav class="md-nav" aria-label="4. Integrating with FINEOS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-pfml-credentials-for-fineos" class="md-nav__link">
    Configure PFML credentials for FINEOS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-fineos-credentials-for-pfml" class="md-nav__link">
    Configure FINEOS credentials for PFML
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-update-ci-and-monitoring" class="md-nav__link">
    4. Update CI and Monitoring
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-custom-domains" class="md-nav__link">
    Setting up Custom Domains
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/EOLWD/PFML/edit/master/docs/creating-environments.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="setting-up-a-new-environment">Setting up a new environment</h1>
<p>Full E2E process (SOP): https://lwd.atlassian.net/wiki/spaces/DD/pages/1549860868/SOP+New+Environment+Build</p>
<hr />
<p>The easiest way to set up resources in a new environment is using the templates in <a href="https://github.com/EOLWD/pfml/tree/main/bin/bootstrap-env">/bin/bootstrap-env/</a>.</p>
<h2 id="1-initial-setup">1. Initial Setup</h2>
<ol>
<li>Update the <a href="https://github.com/EOLWD/pfml/tree/main/infra/constants/outputs.tf">infra/constants/outputs.tf</a> file, specifically:</li>
<li>environment_tags</li>
<li>environment_shorthand</li>
<li>smartronix_environment_tags</li>
</ol>
<p>You do not need to update domains, api_domains, or cert_domains at this time.</p>
<p>For smartronix_environment_tags, reach out to Ron Lovell, Karen Grant, Andy Rodriguez, and Chris Griffith and ask what the new tag should be based on the environment name. They will kick off the Smartronix CAMS infra-monitoring harness for the new environment as well as start any manual DBA steps for the database.</p>
<p>If you need a new EOTSS-approved tag for environment_tags, send an email to <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#84;&#105;&#109;&#46;&#76;&#46;&#83;&#104;&#97;&#114;&#112;&#101;&#64;&#109;&#97;&#115;&#115;&#46;&#103;&#111;&#118;">&#84;&#105;&#109;&#46;&#76;&#46;&#83;&#104;&#97;&#114;&#112;&#101;&#64;&#109;&#97;&#115;&#115;&#46;&#103;&#111;&#118;</a> requesting a new tag.</p>
<ol>
<li>
<p>The S3 bucket for holding tfstate files must be created first in <a href="https://github.com/EOLWD/pfml/tree/main/infra/pfml-aws/s3.tf">infra/pfml-aws/s3.tf</a>. Run <code>terraform apply</code>. This may require admin permissions.</p>
</li>
<li>
<p>Send a request to EOTSS (Roy Mounier, cc. Chris Griffith) to update the NonProd Admin role to include <code>arn:aws:s3:::*-pfml-NEW_ENV*</code> and <code>arn:aws:s3:::*-pfml-NEW_ENV-*/*</code> in the S3 permissions. If Roy is out, create a Service Now request.</p>
</li>
<li>
<p>Search for "AWS Role Access Request/Adjustment"</p>
</li>
<li>Select "Cloud Engineer" if needed by the form.</li>
<li>Select "EOLWD Core" for account.</li>
<li>Select "No" for "Member of Cloud Operations Team."</li>
<li>
<p>In the justification, request the following: "Request for the PFML Account (498823821309). The Nonprod-Admin role should allow access to read from new S3 buckets created for the NEW_ENV environment that is being stood up."</p>
</li>
<li>
<p>After that, individual terraform components (<code>env-shared</code>, <code>api</code>, <code>ecs-tasks</code>, or <code>portal</code>) may be set up. We'll use this pattern:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code>pfml$ bin/bootstrap-env/bootstrap-env.sh &lt;new-env&gt; &lt;component&gt;
</code></pre></div>
<h2 id="2-set-up-the-api">2. Set up the API</h2>
<h3 id="20-create-the-api-gateway">2.0 Create the API Gateway</h3>
<ol>
<li>Generate the terraform environment folder:</li>
</ol>
<div class="highlight"><pre><span></span><code>pfml$ bin/bootstrap-env/bootstrap-env.sh NEW_ENV env-shared
</code></pre></div>
<p>The command above creates a new directory: <code>infra/env-shared/environments/NEW_ENV</code></p>
<ol>
<li>From the new directory, update variables in <code>main.tf</code> and run:</li>
</ol>
<div class="highlight"><pre><span></span><code>terraform init
</code></pre></div>
<ol>
<li>
<p>Create the environment:</p>
<div class="highlight"><pre><span></span><code>terraform plan
</code></pre></div>
<div class="highlight"><pre><span></span><code>terraform apply
</code></pre></div>
</li>
</ol>
<h3 id="21-create-the-api">2.1 Create the API</h3>
<ol>
<li>
<p>Manually create <code>/service/pfml-api-dor-import/NEW_ENV/gpg_decryption_key</code> in Parameter Store. Copy the value from TEST and use a SecureString on the Advanced Tier.</p>
</li>
<li>
<p>Setup the rest of the secrets in Parameter Store by running ./bin/bootstrap-env/copy-parameters.sh NEW_ENV</p>
</li>
</ol>
<details>
   <summary>Known and accounted for at time of writing:</summary>

   <div class="highlight"><pre><span></span><code>Copy from stage:
- /service/pfml-api-comptroller/NEW_ENV/eolwd-moveit-ssh-key
- /service/pfml-api-comptroller/NEW_ENV/eolwd-moveit-ssh-key-password
- /service/pfml-api-dor-import/NEW_ENV/gpg_decryption_key_passphrase
- /service/pfml-api/NEW_ENV/ctr-data-mart-password
- /service/pfml-api/NEW_ENV/rmv_client_certificate_password
- /service/pfml-api/NEW_ENV/service_now_username
- /service/pfml-api/NEW_ENV/service_now_password

Manually generate a string and pop it in there:
- /service/pfml-api/NEW_ENV/dashboard_password
- /service/pfml-api/NEW_ENV/db-nessus-password

Generated automaticallly in terraform (no action needed):
- /service/pfml-api/NEW_ENV/db-password

Copy from `Cognito AWS Console &gt; app clients` after Portal/Cognito is created:
- /service/pfml-api/NEW_ENV/cognito_fineos_app_client_id
- /service/pfml-api/NEW_ENV/cognito_internal_fineos_role_app_client_id
- /service/pfml-api/NEW_ENV/cognito_internal_fineos_role_app_client_secret

Received from FINEOS (more details below):
- /service/pfml-api/NEW_ENV/fineos_oauth2_client_secret
</code></pre></div>
   </details>

<ol>
<li>Add the new environment to <code>api/newrelic.ini</code> to set up New Relic APM:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">[newrelic:NEW_ENV]</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">PFML-API-NEW_ENV</span>
<span class="n">monitor_mode</span> <span class="o">=</span> <span class="kc">true</span>
</code></pre></div>
<ol>
<li>Generate the terraform environment folder: </li>
</ol>
<div class="highlight"><pre><span></span><code>pfml$ bin/bootstrap-env/bootstrap-env.sh NEW_ENV api
</code></pre></div>
<p>The command above creates a new directory: <code>infra/api/environments/NEW_ENV</code></p>
<ol>
<li>
<p>From the new directory, update variables in <code>main.tf</code>, namely:</p>
</li>
<li>
<p>nlb_port: same port as specified in the API gateway.</p>
</li>
<li>cors_origins: set this to be the execute-api URL from API gateway for now. [API_GATEWAY_URL]</li>
<li>
<p>rmv_client_certificate_arn: Retrieve the secretsmanager ARN from AWS secrets manager or from the copy-parameters script output.</p>
</li>
<li>
<p>Run:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code>terraform init
</code></pre></div>
<ol>
<li>
<p>Create the environment, providing an initial application version to deploy. Since this requires a version that is built and pushed to ECR, it's easiest to use the latest version that was <a href="https://github.com/EOLWD/pfml/deployments/activity_log?environment=API+%28test%29">deployed in TEST</a>. This is a Docker image tag that is equivalent to a commit hash.</p>
<div class="highlight"><pre><span></span><code>$ terraform apply <span class="se">\</span>
-var<span class="o">=</span><span class="s1">&#39;service_docker_tag=82043ae1e04621251fb9e7896176b38c884f027e&#39;</span>
</code></pre></div>
</li>
</ol>
<p>Note that the API will not be working until database migrations are run.</p>
<h3 id="22-create-the-ecs-tasks">2.2 Create the ECS Tasks</h3>
<ol>
<li>Generate the terraform environment folder: </li>
</ol>
<div class="highlight"><pre><span></span><code>pfml$ bin/bootstrap-env/bootstrap-env.sh NEW_ENV ecs-tasks
</code></pre></div>
<p>The command above creates a new directory: <code>infra/ecs-tasks/environments/NEW_ENV</code></p>
<ol>
<li>
<p>Create a PR and run a deployment of this branch to the new environment. See <a href="../deployment/">./deployment.md</a>. This should automatically:</p>
</li>
<li>
<p>Initialize and apply the ECS tasks terraform.</p>
</li>
<li>Run database migrations.</li>
<li>Create the required database users for FINEOS and Smartronix Nessus scans. </li>
</ol>
<h2 id="3-setting-up-the-portal-environment">3. Setting up the Portal Environment</h2>
<ol>
<li>Generate the terraform environment folder:</li>
</ol>
<div class="highlight"><pre><span></span><code>pfml$ bin/bootstrap-env/bootstrap-env.sh NEW_ENV portal
</code></pre></div>
<p>The command above creates a new directory: <code>infra/portal/environments/NEW_ENV</code>
1. From the new directory, run:</p>
<div class="highlight"><pre><span></span><code>terraform init
</code></pre></div>
<ol>
<li>
<p>Create the environment, providing a specific <code>cloudfront_origin_path</code> since nothing will be deployed yet. You can use a blank path for now:</p>
<div class="highlight"><pre><span></span><code>terraform plan -var<span class="o">=</span><span class="s1">&#39;cloudfront_origin_path=&#39;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>terraform apply -var<span class="o">=</span><span class="s1">&#39;cloudfront_origin_path=&#39;</span>
</code></pre></div>
</li>
<li>
<p>Sync the cognito secrets to parameter store: </p>
</li>
</ol>
<div class="highlight"><pre><span></span><code>bin/bootstrap-env/sync-cognito-variables.sh <span class="nv">$NEW_ENV</span>
</code></pre></div>
<ol>
<li>Update infra/api/environments/NEW_ENV/main.tf and infra/ecs-tasks/environments/NEW_ENV/main.tf to include the cognito variables as output from the previous script.</li>
</ol>
<div class="highlight"><pre><span></span><code>cognito_user_pool_arn = &quot;arn:aws:cognito-idp:us-east-1:498823821309:userpool/$pool_id&quot;
cognito_user_pool_id = &quot;$pool_id&quot;
cognito_user_pool_client_id = &quot;$api_client_id&quot;
cognito_user_pool_keys_url = &quot;https://cognito-idp.us-east-1.amazonaws.com/$pool_id/.well-known/jwks.json&quot;
</code></pre></div>
<ol>
<li>Follow <a href="../portal/creating-environments/">additional steps for new Portal environments</a>.</li>
</ol>
<h3 id="configuring-cognito">Configuring Cognito</h3>
<p><strong>This is only required for environments that will not run E2E tests. For most environments this is not required.</strong></p>
<p>In production, we block high-risk login attempts. This can also be configured for other environments if desired. High-risk login attempts aren't blocked in environments used for testing so that automated test scripts don't get blocked.</p>
<p>Our Terraform scripts enable Advanced Security. however at the time of writing, <a href="https://github.com/hashicorp/terraform-provider-aws/issues/7007">Terraform didn't support more granular configuration of the Advanced Security settings</a>, so there are some manual steps needed:</p>
<ol>
<li>Log into the AWS Console and navigate to the Cognito User Pool for this environment.</li>
<li>Click "Advanced Security" in the sidebar</li>
<li><a href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pool-settings-advanced-security.html#cognito-user-pool-configure-advanced-security">Configure the adaptive authentication behavior</a>.</li>
<li>On the same page in AWS customize the email notification messages by copy-and-pasting the HTML email templates from <a href="https://github.com/EOLWD/pfml/tree/main/infra/portal/templates/emails/"><code>infra/portal/templates/emails</code></a>.</li>
<li>Ensure the email FROM address is <code>"NEWENV-SHORTHAND_Department of Family and Medical Leave" \&lt;PFML_DoNotReply@eol.mass.gov\&gt;"</code>.</li>
</ol>
<h2 id="4-integrating-with-fineos">4. Integrating with FINEOS</h2>
<h3 id="configure-pfml-credentials-for-fineos">Configure PFML credentials for FINEOS</h3>
<ol>
<li>Create the FINEOS user the in PFML database.</li>
</ol>
<div class="highlight"><pre><span></span><code>./bin/run-ecs-task/run-task.sh NEW_ENV db-create-fineos-user FIRST_NAME.LAST_NAME
</code></pre></div>
<ol>
<li>Create a file locally with the Cognito FINEOS app client ID and secret. You can view this data by going to AWS Console &gt; AWS Cognito &gt; User Pools &gt; [[ select the environment's user pool ]] &gt; App Clients. Look for the <code>fineos-pfml-{env}</code> client.</li>
<li>
<p>Send it to FINEOS over interchange, then delete the file from your local computer. Also send the following details:</p>
</li>
<li>
<p>Auth URL: (e.g. https://paidleave-api-cps-preview.eol.mass.gov/api/v1/oauth2/token)</p>
</li>
<li>Integration URLs (e.g. https://paidleave-api-cps-preview.eol.mass.gov/api/v1/rmv-check, https://paidleave-api-cps-preview.eol.mass.gov/api/v1/financial-eligibility)</li>
<li>VPC IP Address (Should be nonprod IP: VPC-EOLWD-PFML-NonProd, vpc-097793bd468be1c65, 10.203.224.0/22)</li>
<li>VPC ID (Should be nonprod IP: VPC-EOLWD-PFML-NonProd, vpc-097793bd468be1c65, 10.203.224.0/22)</li>
<li>VPC S3 Endpoint ID (Should be nonprod endpoint: vpce-057c4dd758ba5ccb1)</li>
</ol>
<h3 id="configure-fineos-credentials-for-pfml">Configure FINEOS credentials for PFML</h3>
<ol>
<li>FINEOS should send a file to us with an oauth client ID and secret. If not, ping Howard Teasley and Darnel.</li>
<li>The client ID should be configured in <strong>both</strong>:</li>
<li>infra/api/environments/NEW_ENV/main.tf and </li>
<li>infra/ecs-tasks/environments/NEW_ENV/main.tf.</li>
<li>The client secret value should be updated in parameter store (<code>/service/pfml-api/NEW_ENV/fineos_oauth2_client_secret</code>).</li>
</ol>
<p>Verify the following details with FINEOS:
- Will SSO be enabled? (If so, we need to configure the FINEOS user as OASIS instead of CONTENT)
- What is the FINEOS URL?
- What is the FINEOS S3 path for data exports/imports?</p>
<h2 id="4-update-ci-and-monitoring">4. Update CI and Monitoring</h2>
<ol>
<li>Add the new environment to the <a href="https://github.com/EOLWD/pfml/tree/main/.github/workflows/infra-validate.yml">CI build matrix</a> so it can be validated when it's changed.</li>
<li>Add the environment to the <a href="https://github.com/EOLWD/pfml/tree/main/infra/monitoring/alarms.tf">monitoring module</a> to create API and Portal alarms that are linked to PagerDuty.</li>
</ol>
<h2 id="setting-up-custom-domains">Setting up Custom Domains</h2>
<p>If we expect FINEOS to call the PFML API, you'll need a custom mass.gov domain for the environment. Please f    ollow these steps:</p>
<ol>
<li>Request an ACM cert in the AWS Console &gt; AWS Certificate Manager, with Email Verification. Example:</li>
</ol>
<table>
<thead>
<tr>
<th>Domain Name</th>
<th>SANs</th>
</tr>
</thead>
<tbody>
<tr>
<td>paidleave-performance.eol.mass.gov</td>
<td>paidleave-training.eol.mass.gov,<br>paidleave-api-training.eol.mass.gov,<br>paidleave-api-performance.eol.mass.gov</td>
</tr>
</tbody>
</table>
<ol>
<li>Send an email to Vijay with the domain name/SANs, so he can request approval from Sarah Bourne / Chris Velluto / Bill Cole. Boilerplate:</li>
</ol>
<div class="highlight"><pre><span></span><code>To: Rajagopalan, Vijay (DFML) &lt;Vijay.Rajagopalan2@mass.gov&gt;; 
    Griffith, Christopher (EOL) &lt;Christopher.Griffith@detma.org&gt;;
    Bourne, Sarah (EOTSS) &lt;sarah.bourne@mass.gov&gt;; 
    Velluto, Christopher (EOTSS) &lt;christopher.velluto@mass.gov&gt;; 
    Cole, William (EOTSS) &lt;william.cole@mass.gov&gt;

cc: Yeh, Kevin (DFML) &lt;Kevin.Yeh@mass.gov&gt;

Hi all,

We’re setting up the PFML API and Portal breakfix and cps-preview environments to interface with new FINEOS environments.

I’ll be requesting an ACM certificate shortly. The certificate request will be as outlined below:

domain_name: paidleave-ENV.eol.mass.gov
SANs: paidleave-api-ENV.eol.mass.gov, paidleave-OTHER_ENV.eol.mass.gov, paidleave-api-OTHER_ENV.eol.mass.gov

@Rajagopalan, Vijay (DFML) @Griffth, Chris (EOL) can you confirm this request from the PFML end?

Thanks.
</code></pre></div>
<ol>
<li>
<p>Once EOTSS has approved the certificate, update the domains, api_domains, and cert_domains map in the following file:</p>
</li>
<li>
<p><a href="https://github.com/EOLWD/pfml/tree/main/infra/constants/outputs.tf">infra/constants/outputs.tf</a></p>
</li>
<li>
<p>After merging and applying the changes, create a ServiceNow request for CNAME entries for the Portal and Gateway. </p>
</li>
</ol>
<p>These should all be cloudfront URLs. Check the AWS Console under API Gateway &gt; Custom Domain Names for the API Gateway Cloudfront URLs.</p>
<table>
<thead>
<tr>
<th>App</th>
<th>CNAME</th>
<th>URL</th>
</tr>
</thead>
<tbody>
<tr>
<td>API perf</td>
<td>paidleave-api-performance.eol.mass.gov</td>
<td>https://abcd123.cloudfront.net</td>
</tr>
<tr>
<td>API training</td>
<td>paidleave-api-training.eol.mass.gov</td>
<td>https://zaww123.cloudfront.net</td>
</tr>
<tr>
<td>Portal perf</td>
<td>paidleave-performance.eol.mass.gov</td>
<td>https://vfcs123.cloudfront.net</td>
</tr>
<tr>
<td>Portal training</td>
<td>paidleave-training.eol.mass.gov</td>
<td>https://qwer123.cloudfront.net</td>
</tr>
</tbody>
</table>
<p>Visit https://massgov.service-now.com/sp and search for DNS (Domain Name System). Create one ticket per record.</p>
<p>Fill details in as follows (example):</p>
<p><img width="400" alt="Screen Shot 2021-04-15 at 1 24 54 PM" src="https://user-images.githubusercontent.com/2308368/114912713-53e18d00-9dee-11eb-9561-30034d00090d.png"></p>
<p>Example Description:</p>
<div class="highlight"><pre><span></span><code>Please create a new CName entry to point paidleave-api-breakfix.eol.mass.gov to djoikhjp9s25o.cloudfront.net.

Point of Contacts for more info: 
Rajagopalan, Vijay (DFML) &lt;Vijay.Rajagopalan2@mass.gov&gt; 
Griffith, Christopher (EOL) &lt;Christopher.Griffith@detma.org&gt;
</code></pre></div>
<ol>
<li>After they create the CNAME entries, the custom domains should direct to the appropriate applications.</li>
</ol>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../contributing/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Contributing" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Contributing
            </div>
          </div>
        </a>
      
      
        
        <a href="../deployment/" class="md-footer__link md-footer__link--next" aria-label="Next: Deployment" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Deployment
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.409db549.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.56a63758.min.js"></script>
      
    
  </body>
</html>